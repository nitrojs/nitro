---
icon: codicon:run-all
---

# Tasks

> Nitro tasks allow on-off operations in runtime.

## Opt-in to the experimental feature

> [!IMPORTANT]
> Tasks support is currently experimental and available in [nightly channel](/guide/nightly).
> See [unjs/nitro#1974](https://github.com/unjs/nitro/issues/1974) for the relavant discussion.

In order to tasks API you need to enable experimental feature flag.

::code-group
```ts [nitro.config.ts]
export default defineNitroConfig({
  experimental: {
    websocket: true
  }
})
```

```ts [nuxt.config.ts]
export default defineNuxtConfig({
  nitro: {
    experimental: {
      websocket: true
    }
  }
})
```
::

## Usage

Task files can be defined in `tasks/[name].ts` (`server/tasks/[name].ts` in Nuxt) or manually in the `tasks: {}` configuration in `nitro.config` (`nitro: { tasks: {} }` in `nuxt.config`). If nested, the name will be joined with `:` (`tasks/db/migrate` => task name: `db:migrate`)


Example: Define a nitro task

```ts
// tasks/db/migrate.ts
export default defineNitroTask({
  description: "Run database migrations",
  run(payload, context) {
    console.log("Running DB migration task...", { payload });
    return "Success";
  },
});
```

To execute tasks, we can call them in runtime (in an event handler for example) using `runNitroTask`

Example: Execute a nitro task in an event handler:

```ts
// api/migrate.ts`
export default eventHandler(async (event) => {
  // !!! TODO: Authenticate user !!!
  // !!! TODO: Validate payload  !!!
  const payload = { ...getQuery(event) };
  const { result } = await runNitroTask("db:migrate", payload);
  return { result };
});
```

It is also possible to run tasks while the development server **is running**:

Using API:

- `/_nitro/tasks` returns a list of available task names and their meta
- `/_nitro/tasks/:name` executes a task. You can provide a payload using both query parameters and body JSON payload.

Using CLI:

- Run `npm run nitro tasks run db:migrate --payload "{}"`
- Run `npm run nitro tasks list` to show the list of available tasks


```[tasklist]
### Tasks
- [x] Initial Implementation (#1929)
- [ ] Write documentation section (PR welcome!)
- [ ] Ability to run tasks using CLI against production build
- [ ] Stablize API / return values
- [ ] Integrate with Cron Tasks / Background Jobs
- [ ] Task hooks (on dev start, production start and production build)
- [ ] https://github.com/unjs/nitro/issues/2021
```
